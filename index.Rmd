---
title: "Proporción de escaños en el parlamento ocupado por mujeres 2020 - Análisis de los resultados"
author: "Integrantes: Xiomara Oshikawa, Kamila Gamarra, Luciana Rojas, Maria Fernanda Carrillo"
subtitle: 'Curso: POL304 - Estadística para el análisis político 2'
output:
  prettydoc::html_pretty:
    theme: hpstr
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,echo=FALSE, out.width="40%",fig.align="center"}
knitr::include_graphics("logoPUCP.png") 
```

```{r echo=FALSE}
gitLink="https://raw.githubusercontent.com/XiomaraOshik/Est_2/main/data.csv"
data=rio::import(gitLink)
```

```{r include=FALSE}
#Librerías del ejercicio:.
library(rio)
library(dplyr)
library(ggplot2)
library(cowplot)
library(kableExtra)
library(reshape)
library(DT)
library(equatiomatic)
library(modelsummary)
library(factoextra)
library(cluster)
```

El objetivo de este reporte es analizar qué factores determinan el porcentaje de presencia femenina en cargos políticos, específicamente en los parlamentos, en diferentes países del mundo. 

Consideramos que es un tema importante ya que, a pesar de un notable progreso en la participación política femenina en las últimas décadas, aún existe un gran brecha entre representantes masculinos y femeninos, lo que desencadena en la perpetuación de las condiciones desfavorables de las mujeres y su invisibilización política. 

Para la comprensión de la presente investigación, se consideran las siguientes variable: 

Variable dependiente: Proporción de escaños ocupados por mujeres en los parlamentos

Variables independientes: 

 1. Porcentaje de empleo vulnerable femenino

 2. Porcentaje de la población activa mujeres

 3. Gasto público en educación

 4. PBI per cápita nacional del 2015


Se llevarán a cabo los siguientes análisis:

- Realizar un análisis descriptivo y georreferenciado de los escaños en los parlamentos ocupados por mujeres a nivel de cada país. 
- Implementar técnicas multivariadas para analizar el efecto de cada variable independiente en la presencia de mujeres en  los escaños parlamentarios.
- Aplicar técnicas de reducción de dimensiones para agrupar a los países en función a la proporción de escaños parlamentarios ocupados por mujeres en el año 2020.


```{r include=FALSE}

gitLink="https://raw.githubusercontent.com/XiomaraOshik/Est_2/main/data.csv"
data=rio::import(gitLink)
library(magrittr)
data%>%
rmarkdown::paged_table()

str(data)
```

### 1. Análisis rápido de los resultados:

```{r echo=FALSE}
library(stringi)

names(data)=stri_trans_general(str = names(data), 
                               id = "Latin-ASCII")
```


```{r echo=FALSE}
datatable(data, filter = "top")
```

```{r include=FALSE}
Dependiente = data[,c(1,3)]
colnames(Dependiente)[2] = "Proporción de escaños parlamentarios ocupados por mujeres"
```

En promedio, la proporción de las mujeres que ocupan un escaño en el parlamento de cada país es 24,73. La proporción de mujeres que ocupan un escaño en el parlamento por país se puede observar en la tabla a continuación:

```{r echo=FALSE}
datatable(Dependiente, filter = "top")
```

### Distribución de la proporción de escaños parlamentarios ocupados por mujeres en cada país

El presente trabajo analiza la dinámica de la participación política femenina en un total de 180 países. A continuación, presentamos un mapa mundial que referencia geográficamente la estudiada actividad a partir de la intensidad del color. La representación esbozada amplía la profundidad del análisis. De ese modo, se entiende al fenómeno a partir de rasgos sociológicos, como la etnia mayoritaria, o políticos como la estabilidad. Así, observamos diferencias en la dinámica según cada región global.  En esa línea, Escandinavia (norte de Europa), comprendida por Suecia, Dinamarca, Noruega, Finlandia e Islandia, presenta el mayor índice de participación femenina del mundo. Esto debido a la histórica implementación de políticas de corte feminista. En contraste, el África subsahariana carece casi en su totalidad de presencia femenina en el parlamento. Esto ocurre en un marco de inestabilidad política y conflictos étnicos constantes. Del mismo modo, el Sudeste Asiático, Asia Central y Eurasia (Rusia) poseen indicadores desalentadores debido al paternalismo que impera en sus sociedades. Por último, se aprecia la ambivalencia de Latinoamérica. Así, Estados gobernados por la izquierda presentan mayor participación femenina. Se observa un patrón positivo en el Norte Global: Norteamérica, Oceanía y Europa. Asimismo, se comprende la ausencia de data en zonas de conflicto bélico permanente, hermetismo o inestabilidad política como el Magreb (norte de África), Oriente Próximo, Afganistán y Corea del Norte.

```{r include=FALSE}
library(sf) 
mapWLD=sf::read_sf("world-administrative-boundaries.shp")
head(mapWLD)
```

```{r include=FALSE}
mapMUN=merge(mapWLD,data,by.x='iso3',by.y='codigo', all.x = T)
head(mapMUN)
```

```{r include=FALSE, echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=9.5,fig.height=5.55}
library(ggplot2)
mapaleyendaL= ggplot(mapMUN)+ geom_sf() + theme_light()

mapaleyL= mapaleyendaL + geom_sf(data=mapMUN,
              aes(fill=parlamentos2020),color = NA)
      
```

```{r echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=9.5,fig.height=5.55}
mapa3= mapaleyL +
coord_sf() + 
scale_fill_gradient(low = "#FDFEFE",  high = "red", breaks=seq(from=0, to=61.25, by=20)) + theme_void() + 
  
theme(axis.title = element_blank(), axis.text = element_blank(), legend.position = c(0.16,0.1)) + labs(fill="Escaños parlamentarios mujeres") + theme(legend.text = element_text(size = 10)) +
  
labs(title = "Distribución de la proporción de escaños parlamentarios ocupados por mujeres en cada país", subtitle = "Escala del 0 al 100") +
  
theme(
plot.title = element_text(color="black", size=15, face="bold"),
plot.caption = element_text(color = "black", size=10))

mapa3
```



```{r include=FALSE}
parlamentomuj = data[,c(1,3)]
parlamentomuj_summary = as.data.frame(apply(parlamentomuj[-1],2,summary))
```

Si se exploran algunos datos descriptivos, se observa que en promedio, la proporción (en una escala de 0-100) de los escaños parlamentarios ocupados por mujeres bordea un 24,73 en cada país estudiado de la presente investigación. Además,  el 50% de los países estudiados presentan una proporción de hasta 23,77 de presencia femenina sus escaños parlamentarios. Entre los que muestran una mayor proporción de escaños ocupados por mujeres en el parlamento se encuentran: Rwanda (61,25), Nueva Zelandia (48,33) y México (48,20). En contraste, los países con menor porcentaje de presencia femenina son Vanuatu (0.0), Maldivas (4.6) y Líbano (4.69)

La distribución de la proporción de escaños ocupados por mujeres se puede observar en el gráfico a continuación:

```{r echo=FALSE}
parlamentomuj_summary%>%
  kbl() %>%
  kable_minimal()
```
La distribución de escaños ocupados por mujeres en el parlamento se puede observar en el gráfico a continuación:

```{r include=FALSE}
parlamentomuj = melt(parlamentomuj, id=c("codigo"))
```

```{r echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=7,fig.height=5, fig.align="center"}
ggplot(data= parlamentomuj, aes(x=value, group=variable, fill=variable)) +
    geom_density(adjust=1.5, alpha=.4, color = "black", linetype = "dashed") +
      scale_fill_manual(values=c("firebrick","dodgerblue2"), name = "")  +
      theme(legend.position="bottom") +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank())  +
  
  labs(title = "Concentración de países acorde a la presencia femenina en los escaños parlamentarios",
       x = " ",
       y = " ") 

```

### 2. Modelando el comportamiento de la presencia de mujeres en  los escaños parlamentarios

Efecto de las variables población vulnerable femenina, población activa mujeres, gasto público en educación y PBI 
 

```{r include=FALSE}
modelo = lm(parlamentos2020 ~ Por_Vulnerable_Femenino_2015 + Poblacion_Act_Mujeres2015 + Gasto_public_educacion_2015 + PBI_2015, data = data)
```

```{r echo=FALSE}
equatiomatic::extract_eq(modelo, use_coefs = TRUE)
```

```{r echo=FALSE}
modelsummary(modelo, title = "OLS",
             stars = TRUE,
             output = "kableExtra")
```

Podemos afirmar que el modelo es válido porque nuestro p-valor es menor a 0.05. También se aprecia que la variable agregada: PBI_2015 tiene efecto estadísticamente significativo. Así, si nuestra variable independiente aumenta en una unidad, la dependiente también lo hará en 0.0002. Esto es una cantidad poco representativa tomando en cuenta a los valores obtenidos en regresiones anteriores. Por otro lado, nuestro modelo es confiable al 20%. Por último, observamos que la inserción de esta nueva variable independiente afecta a sus predecesoras (Por_Vulnerable_Femenino_2015, Población_Act_Mujeres2015 y Gasto_Public_Educacion_2015), aunque no supone algún cambio abrupto respecto a sus valores en la regresión anterior.


En resumen, el presente modelo, que incluye las 4 variables independientes, cuenta con un 20% de confiabilidad. En este sentido, las 4 variables son significativas para poder analizar las variaciones que existen en cada país acerca del porcentaje de las mujeres en los escaños de los parlamentos. 

```{r include=FALSE}
library(stargazer)
library(jtools)
```


```{r}
plot_summs(modelo,scale = TRUE)
```

## Interpretación Kami

### 3. Técnicas de reducción de dimensiones

Vamos a agrupar a los distintos países en función a sus características sociodemográficas, siguiendo técnicas de reducción de dimensiones. Tenemos tres estrategias: PAM, jerárquica y basada en densidad.

```{r include=FALSE}
inputData = data[,c(1,3:7)]
row.names(inputData) = inputData$codigo
inputData = inputData[,-c(1)]
```

```{r include=FALSE}
Data_clusters = daisy(inputData, metric="gower")
```

Las tres opciones nos recomiendan la misma cantidad de agrupamiento de casos. En tal sentido, por preferencia de investigación, se ha optado por la estrategia de aglomeración jerarquica, bajo el algoritmo DIANA. Esto se debe a que, esta estrategia demuestra un buen desempeño en el agrupamiento de casos y no presenta ningún caso de dato mal clusterizado.

```{r include=FALSE}
fviz_nbclust(inputData, pam,diss=Data_clusters,method = "gap_stat",k.max = 10,verbose = F) #Nos recomienda 2
```

```{r include=FALSE}
set.seed(123)
res.pam=pam(Data_clusters,2,cluster.only = F)

#nueva columna
inputData$pam=res.pam$cluster
```


### Clusterización vía  PAM

```{r echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=7,fig.height=5, fig.align="center"}
fviz_silhouette(res.pam,print.summary = F)
```

```{r include=FALSE}
res.agnes<- hcut(Data_clusters, k = 2,hc_func='agnes',hc_method = "ward.D")

inputData$agnes=res.agnes$cluster

```

### Clusterización vía AGNES

```{r echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=7,fig.height=5, fig.align="center"}
fviz_silhouette(res.agnes,print.summary = F)
```

### Clusterización vía DIANA

```{r include=FALSE}
set.seed(123)
res.diana <- hcut(Data_clusters, k = 2,hc_func='diana')
inputData$diana=res.diana$cluster
```

```{r echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=7,fig.height=5, fig.align="center"}
fviz_silhouette(res.diana,print.summary = F)
```

*Interpretar el 3ero - Diana
  Como parte de la interpretación mostrar los casos mal clusterizados


```{r include=FALSE}
#Agregamos conglomerados:
inputData$clust = factor(res.diana$cluster)
```

```{r include=FALSE}}
#Lo pasamos a la data original:
inputData$codigo = row.names(inputData)
row.names(inputData) = NULL
inputData = inputData[,c(8)]
```


*Error 

```{r include=FALSE}
data = merge(data, inputData, by = "codigo")
```



```{r include=FALSE}
data$diana = factor(data$diana, levels = c(1:2), labels = c("Presencia alta de mujeres","Presencia baja de mujeres"))
```

Características de cada conglomerado:

```{r include=FALSE}
summ_clust = data %>% 
  group_by(clust) %>%
  summarise(Vulnerable_Femenino = mean(Por_Vulnerable_Femenino_2015, na.rm=T),
            Población_Activa_Mujeres = mean(Poblacion_Act_Mujeres2015, na.rm = T),
            Gasto_educación = mean(Gasto_public_educacion_2015, na.rm = T),
            PBI = mean(PBI_2015, na.rm =T))
```

```{r echo=FALSE}
summ_clust%>%
  kbl() %>%
  kable_minimal()
```

Número de países por cada conglomerado:

```{r include=FALSE}
bar1 = data %>%
  group_by(clust) %>%
  summarise(Cluster = n())
```

```{r echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=7,fig.height=5, fig.align="center"}
ggplot(bar1, aes(x=clust, y=Cluster)) + 
  geom_bar(stat = "identity") +
  
  labs(title = " ",
       x = " ",
       y = " ") +
    geom_text(aes(label=Cluster), size=4, vjust=1.5, hjust = 0.5, color="white") + 
  
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank())
```

Análisis geoespacial de clusters:

```{r include=FALSE}
#Juntamos información con el shape:
map1=merge(mapWLD,data,by.x='iso3',by.y='codigo', all.x = T) #siempre primero el shape
```


```{r echo=FALSE,message=FALSE,warning=FALSE,eval=TRUE,fig.show='hold',fig.width=9.5,fig.height=5.55, fig.align="center"}
mapaleyendaL= ggplot(map1)+ geom_sf() + theme_light()
mapaleyL= mapaleyendaL + geom_sf(data=map1,
              aes(fill=clust),color = "gray")
      
mapa1= mapaleyL +
coord_sf() + 
scale_fill_manual(values=c("purple","turquoise","lightgoldenrod1")) + theme_void() +
  
  
theme(axis.title = element_blank(), axis.text = element_blank(), legend.position = "right") + labs(fill=" ") + theme(legend.text = element_text(size = 8)) +
  
labs(title = "Países según conglomerado de escaños parlamentarios ocupados por mujeres") +
  
theme(
plot.title = element_text(color="black", size=11, face="bold"))
mapa1
```




















